#!/usr/bin/env bash

set_prompts() {
  if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
		tput sgr0; # reset colors

		bold=$(tput bold);
		reset=$(tput sgr0);

		black=$(tput setaf 0);
		blue=$(tput setaf 4);
		cyan=$(tput setaf 6);
		gray=$(tput setaf 8);
		green=$(tput setaf 2);
		orange=$(tput setaf 3);
		purple=$(tput setaf 5);
		red=$(tput setaf 1);
		violet=$(tput setaf 5);
		white=$(tput setaf 15);
		yellow=$(tput setaf 3);
  fi

  # Highlight the user name when logged in as root.
  if [[ "${USER}" == "root" ]]; then
    userStyle="${red}";
  else
    userStyle="${yellow}";
  fi;
  if [[ $(uname -a | grep raspberrypi) ]]; then
    userStyle="${violet}"
  fi;

  # Highlight the hostname when connected via SSH.
  if [[ "${SSH_TTY}" ]]; then
    hostStyle="${bold}${red}";
  else
    hostStyle="${yellow}";
  fi;

  # Set the terminal title to the current working directory
  PS1="\[\033]0;\h\007\]";

  PS1+="\[${userStyle}\]\u"; # username
  PS1+="\[${gray}\] in ";
  PS1+="\[${green}\]\w"; # working directory
  PS1+='`prompt_git "${gray} on ${violet}"`'; # git repository details
  PS1+="\n";
  PS1+='\[${reset}\]$ '; # `$` (and reset color)
  export PS1;
}

set_prompts

# Inspired by https://stackoverflow.com/a/14860632
INITIAL_PROMPT_COMMAND="${PROMPT_COMMAND}"
PROMPT_COMMAND='eval $INITIAL_PROMPT_COMMAND && (( PROMPT_CTR-- < 0 )) && {
  PROMPT_COMMAND=$INITIAL_PROMPT_COMMAND
  PS1="\n$PS1"
  unset INITIAL_PROMPT_COMMAND
  unset PROMPT_CTR
}'

unset set_prompts
